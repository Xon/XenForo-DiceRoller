<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="xfa_dice" title="XFA - DiceRoller" version_string="1.3.0-sv" version_id="1030000" url="https://atelieraphelion.com/" install_callback_class="xfaDiceRoller_Installer" install_callback_method="install" uninstall_callback_class="" uninstall_callback_method="">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications/>
  <code_events/>
  <code_event_listeners>
    <listener event_id="load_class" execute_order="10" callback_class="xfaDiceRoller_Listener" callback_method="load_class" active="1" hint="XenForo_Model_Post" description="XenForo_Model_Post"/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="cz_rpg_options" display_order="4000" debug_only="0"/>
    <option option_id="cz_enable_die" edit_format="onoff" data_type="boolean" can_backup="1">
      <default_value>1</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="cz_rpg_options" display_order="1"/>
    </option>
    <option option_id="cz_max_die_per_box" edit_format="textbox" data_type="integer" can_backup="1">
      <default_value>12</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="cz_rpg_options" display_order="1"/>
    </option>
    <option option_id="cz_max_faces" edit_format="textbox" data_type="integer" can_backup="1">
      <default_value>90</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="cz_rpg_options" display_order="1"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions>
      <permission permission_group_id="forum" permission_id="throwDie" permission_type="flag" default_value="unset" interface_group_id="forumPermissions" display_order="400"/>
      <permission permission_group_id="forum" permission_id="viewDice" permission_type="flag" default_value="unset" interface_group_id="forumPermissions" display_order="410"/>
    </permissions>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="permission_forum_throwDie" version_id="1030000" version_string="1.3.0-sv"><![CDATA[Can throw a die]]></phrase>
    <phrase title="permission_forum_viewDice" version_id="1030000" version_string="1.3.0-sv"><![CDATA[View dice]]></phrase>
    <phrase title="cz_rpg_cannot_throw_no_die" version_id="111" version_string="1.1.1"><![CDATA[You cannot throw more than {no} die]]></phrase>
    <phrase title="cz_rpg_faces" version_id="101" version_string="1.1.1"><![CDATA[Faces]]></phrase>
    <phrase title="cz_rpg_faces_must_be_at_least_2" version_id="111" version_string="1.1.1"><![CDATA[You need to type at least 2 faces for the dice]]></phrase>
    <phrase title="cz_rpg_faces_must_be_at_most_no" version_id="111" version_string="1.1.1"><![CDATA[The max number of faces you can use is {no}]]></phrase>
    <phrase title="cz_rpg_from_the_options" version_id="101" version_string="1.1.1"><![CDATA[From the options]]></phrase>
    <phrase title="cz_rpg_incorrect_number_for_faces" version_id="111" version_string="1.1.1"><![CDATA[The number of faces of the dice is not correct]]></phrase>
    <phrase title="cz_rpg_more_options" version_id="101" version_string="1.1.1"><![CDATA[More options]]></phrase>
    <phrase title="cz_rpg_please_enter_post_to_throw" version_id="111" version_string="1.1.1"><![CDATA[You don't seem to have thrown a dice in a post, enter the post]]></phrase>
    <phrase title="cz_rpg_position_error_not_exists" version_id="111" version_string="1.1.1"><![CDATA[Error. The position you are trying to throw the dice in does not exist.]]></phrase>
    <phrase title="cz_rpg_position_error_to_throw" version_id="111" version_string="1.1.1"><![CDATA[The position you are trying to throw the dice is not valid]]></phrase>
    <phrase title="cz_rpg_throwing_a_dice_for" version_id="101" version_string="1.1.1"><![CDATA[Throwing a die for]]></phrase>
    <phrase title="cz_rpg_throw_another_dice" version_id="101" version_string="1.1.1"><![CDATA[Throw another die]]></phrase>
    <phrase title="cz_rpg_throw_a_dice" version_id="101" version_string="1.1.1"><![CDATA[Throw dice]]></phrase>
    <phrase title="cz_rpg_total" version_id="101" version_string="1.1.1"><![CDATA[Total]]></phrase>
    <phrase title="cz_rpg_user_threw_dice" version_id="101" version_string="1.1.1"><![CDATA[{user} threw {faces}-faced die for: {reason}]]></phrase>
    <phrase title="option_cz_enable_die" version_id="101" version_string="1.1.1"><![CDATA[Enable die]]></phrase>
    <phrase title="option_cz_enable_die_explain" version_id="101" version_string="1.1.1"><![CDATA[If enabled, "Throw dice" will be shown in the post]]></phrase>
    <phrase title="option_cz_max_die_per_box" version_id="111" version_string="1.1.1"><![CDATA[Max number of die per box]]></phrase>
    <phrase title="option_cz_max_die_per_box_explain" version_id="111" version_string="1.1.1"><![CDATA[Maximum number of die that can be thrown in a single box inside a post. Try to have something not too high.]]></phrase>
    <phrase title="option_cz_max_faces" version_id="111" version_string="1.1.1"><![CDATA[Faces for die throwing]]></phrase>
    <phrase title="option_cz_max_faces_explain" version_id="111" version_string="1.1.1"><![CDATA[The max number of faces that can be used to throw dice. Ideally between 2 and 100]]></phrase>
    <phrase title="option_group_cz_rpg_options" version_id="101" version_string="1.1.1"><![CDATA[RPG Options]]></phrase>
    <phrase title="option_group_cz_rpg_options_description" version_id="101" version_string="1.1.1"><![CDATA[RPG options for your board like throwing die]]></phrase>
    <phrase title="xfa_rpg_dice_thrown" version_id="120" version_string="1.2.0"><![CDATA[Dice thrown]]></phrase>
  </phrases>
  <route_prefixes>
    <route_type type="public">
      <prefix original_prefix="dice" class="xfaDiceRoller_Route_Prefix_Post" build_link="data_only"/>
    </route_type>
  </route_prefixes>
  <style_properties/>
  <templates>
    <template title="dice" version_id="120" version_string="1.2.0"><![CDATA[<img src="styles/xfa-rpg/dice/{$dice}.png" alt="$dice" />]]></template>
    <template title="dice.css" version_id="101" version_string="1.0.1"><![CDATA[.dice_container
{
	margin: 10px;
	padding: 10px;
	border: #000 1px solid;
	width: 400px;
}

.moreOptionsLink
{
	display: inline;
	width: 100px;
	margin-left: 10px;
}

.dice_container legend
{
	color: {xen:property contentText};
}

fieldset.dice_container
{
	border-color: {xen:property contentText};
}
]]></template>
    <template title="cz_post_diceData" version_id="101" version_string="1.1.1"><![CDATA[<fieldset id="dice-{$message.post_id}-{$diceRoll.boxId}" class="dice_container">
	<legend>
	  {xen:phrase cz_rpg_user_threw_dice, "user=<b>{$message.username}</b>", "faces=<b>{$diceRoll.faces}</b>", "reason=<b>{$diceRoll.reason}</b>"}
	  {xen:phrase cz_rpg_total}: <b><span id="diceLegendTotal-{$message.post_id}-{$diceRoll.boxId}">{$diceRoll.total}</span></b>
	</legend>
	<xen:foreach loop="$diceRoll.roll" value="$dice">
		<xen:include template="cz_dice" />
	</xen:foreach>

	<xen:if is="{$message.canThrowDie}">
		<button type="button" class="ThrowNewDice button" data-url="{xen:link 'dice/addMore', $message, 'boxId={$diceRoll.boxId}'}">
			{xen:phrase cz_rpg_throw_another_dice}
		</button>
	</xen:if>

</fieldset>]]></template>
    <template title="cz_post_messageContent_dice" version_id="101" version_string="1.0.1"><![CDATA[<xen:require css="cz_dice.css" />
<xen:if is="{$message.dice_data}">
	<xen:foreach loop="$message.dice_data" value="$diceRoll">
		<xen:include template="cz_post_diceData" />
	</xen:foreach>
</xen:if>
</xen:if>]]></template>
    <template title="cz_post_publicControls_dice" version_id="101" version_string="1.1.1"><![CDATA[<xen:if hascontent="true">
	<div class="Popup moreOptionsLink">
		<a rel="Menu">{xen:phrase cz_rpg_more_options}</a>
		<div class="Menu">
			<div class="primaryContent menuHeader"><h3>{xen:phrase cz_rpg_more_options}</h3></div>
			<ul class="secondaryContent blockLinksList">
				<xen:contentcheck>
					<xen:if is="{$post.canThrowDie}">
						<a href="{xen:link dice/options, $post}" class="OverlayTrigger item control"><span></span>{xen:phrase cz_rpg_throw_a_dice}</a>
					</xen:if>
				</xen:contentcheck>
			</ul>
		</div>
	</div>
</xen:if>]]></template>
    <template title="cz_rpg_dice_overlay" version_id="111" version_string="1.1.1"><![CDATA[<xen:title>{xen:phrase cz_rpg_throw_a_dice}</xen:title>
<xen:h1>{xen:phrase cz_rpg_throw_a_dice}</xen:h1>

<form action="{xen:link 'dice/add', $post}" method="post" class="xenForm formOverlay AutoValidator" id="DiceRollForm">
	<dl class="ctrlUnit">
		<dt>{xen:phrase cz_rpg_throwing_a_dice_for} ... </dt>
		<dd><input id="diceReason" name="diceReason" type="text" value="" class="textCtrl" maxlength="30" /></dd>
	</dl>
	<dl class="ctrlUnit">
		<dt>{xen:phrase cz_rpg_faces}</dt>
		<dd><input id="diceFaces" name="diceFaces" type="text" value="6" class="textCtrl" /></dd>
	</dl>
	<dl class="ctrlUnit submitUnit">
		<dt></dt>
		<dd>
			<button id="throwDiceBtn" type="submit" class="button primary">{xen:phrase cz_rpg_throw_a_dice}</button>
		</dd>
	</dl>
<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
</form>]]></template>
	margin: auto;
	width: 700px;
	color: #555;
}

#countdown_dashboard {
	height: 110px;
}

.dash {
	width: 110px;
	height: 114px;
	background: transparent url('styles/xfa-rpg/dash.png') 0 0 no-repeat;
	float: left;
	margin-left: 20px;
	position: relative;
}

.dash .digit {
	font-size: 55pt;
	font-weight: bold;
	float: left;
	width: 55px;
	text-align: center;
	font-family: Times;
	color: #555;
	position: relative;
}

.dash_title {
	position: absolute;
	display: block;
	bottom: 0px;
	right: 6px;
	font-size: 9pt;
	color: {xen:property contentText};
	text-transform: uppercase;
	letter-spacing: 2px;
}]]></template>
  </templates>
  <public_template_modifications>
    <modification template="message" modification_key="xfa_dice_message_1" description="dice" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<div class="messageTextEndMarker">&nbsp;</div>]]></find>
      <replace><![CDATA[<xen:include template="cz_post_messageContent_dice" />
$0]]></replace>
    </modification>
    <modification template="post" modification_key="xfa_dice_post_1" description="Dice controls" execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<div class="publicControls">.*?)(</div>)#s]]></find>
      <replace><![CDATA[$1
<xen:include template="cz_post_publicControls_dice" />
$2]]></replace>
    </modification>
    <modification template="thread_view" modification_key="xfa_dice_thread_view_1" description="Preload the option to throw the dice" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:require css="thread_view.css" />]]></find>
      <replace><![CDATA[$0
<xen:require js="js/xfa-rpg/dice.js" />]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
